<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medewerkerbeheer - QPlanning</title>
    <link rel="stylesheet" href="/styles.css">
    <style>
        /* ===== Modal overlay & content (zoals klant) ===== */
        .modal {
            display: none;              /* bij openen in JS -> 'flex' voor centreren */
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            align-items: center;        /* verticaal centreren */
            justify-content: center;    /* horizontaal centreren */
            z-index: 9999;
        }
        .modal-content {
            background: #fff;
            border-radius: .5rem;
            box-shadow: 0 2rem 4rem rgba(0,0,0,.15);
            width: 100%;
            max-width: 500px;
            max-height: 90dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .modal-header, .modal-footer {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid #eee;
        }
        .modal-header { border-bottom: 1px solid #eee; }
        .modal-footer { border-top: 1px solid #eee; border-bottom: 0; }
        .modal-body {
            padding: 1rem 1.25rem;
            overflow-y: auto;
        }
        .modal-close {
            background: transparent;
            border: 0;
            font-size: 1.5rem;
            line-height: 1;
            cursor: pointer;
        }

        /* Kleine badge voor neutrale tekst-waardes */
        .status-badge.status-text {
            background: #f1f5f9;
            color: #0f172a;
            border: 1px solid #e2e8f0;
            padding: .15rem .5rem;
            border-radius: 9999px;
            font-size: .825rem;
        }

        .confirm-modal-content,
        .error-modal-content { max-width: 520px; }

        /* ===== Selects zelfde stijl als inputs ===== */
        select,
        input[type="text"],
        input[type="email"],
        input[type="number"] {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #fff;
            font-size: 0.95rem;
            color: #111827;
            appearance: none;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        select:hover,
        input[type="text"]:hover,
        input[type="email"]:hover,
        input[type="number"]:hover {
            border-color: #9ca3af;
        }
        select:focus,
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
        }
        select {
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="%236b7280" stroke-width="2" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2rem;
        }

        /* Validatie-states: alleen rood bij fout */
        .error { border-color: #ef4444 !important; }
        .error-message {
            min-height: 0.95rem;
            font-size: .85rem;
            margin-top: .25rem;
            color: #b91c1c;
            display: none;
        }
        .error-message.show { display: block; }

        /* Typeahead lijstje */
        .input-dropdown-container { position: relative; }
        .dropdown-suggestions {
            position: absolute;
            z-index: 10;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: .375rem;
            box-shadow: 0 8px 24px rgba(0,0,0,.08);
            display: none;
            max-height: 220px;
            overflow-y: auto;
        }
        .suggestion-item {
            padding: .5rem .75rem;
            cursor: pointer;
        }
        .suggestion-item:hover, .suggestion-item.highlighted {
            background: #f3f4f6;
        }

        /* ===== Zelfde hoogte voor zoekbalk, filters en knoppen ===== */
        .search-box { display: flex; align-items: center; }
        .search-input {
            height: 42px;
            padding: 0 0.75rem;
            font-size: 0.95rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            flex: 1;
            background-color: #fff;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .search-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }

        .filter-options { display: flex; gap: 0.5rem; align-items: center; }
        .filter-select {
            height: 42px;
            padding: 0 0.75rem;
            font-size: 0.95rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #fff;
            appearance: none;
            outline: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" stroke="%236b7280" stroke-width="2" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .filter-select:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }

        .btn.btn-secondary { height: 42px; display: flex; align-items: center; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <div class="logo"><h1>QPlanning</h1></div>
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li><a href="/index.html" class="nav-link active">Overzicht</a></li>
                        <li class="dropdown">
                            <a href="#" class="nav-link dropdown-toggle">Plannen</a>
                            <ul class="dropdown-menu">
                                <li><a href="/Boekingen/BoekingOverzicht.html" class="dropdown-link">Boekingen</a></li>
                                <li><a href="#" class="dropdown-link">Klantenplanning</a></li>
                                <li><a href="/Medewerkerplanning/medewerkerplanning.html" class="dropdown-link">Medewerkerplanning</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="nav-link dropdown-toggle">Beheer</a>
                            <ul class="dropdown-menu">
                                <li><a href="/klanten/klant.html" class="dropdown-link">Klanten beheren</a></li>
                                <li><a href="/Medewerker/medewerkerbeheer.html" class="dropdown-link">Medewerkers beheren</a></li>
                                <li><a href="/Gebruikers/Gebruikers.html" class="dropdown-link">Gebruikers beheren</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="header-right">
                <div class="account-dropdown">
                    <button class="account-btn" id="accountBtn" aria-haspopup="true" aria-expanded="false">
                        <svg class="account-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </button>
                    <ul class="account-menu" id="accountMenu" role="menu">
                        <li><a href="#" class="account-link" role="menuitem">Wijzig wachtwoord</a></li>
                        <li><a href="#" class="account-link" role="menuitem">Log uit</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="content-container">
            <div class="page-header">
                <h2>Medewerkerbeheer</h2>
                <button class="btn btn-primary" id="addEmployeeBtn">Nieuwe medewerker</button>
            </div>

            <div class="filters-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Zoek medewerkers..." class="search-input">
                    <button class="search-clear" id="clearSearch" title="Zoekopdracht wissen">√ó</button>
                </div>
                <div class="filter-options">
                    <select id="statusFilter" class="filter-select">
                        <option value="">Alle statussen</option>
                        <option value="actief">Actief</option>
                        <option value="inactief">Inactief</option>
                    </select>

                    <select id="teamFilter" class="filter-select">
                        <option value="">Alle teams</option>
                        <option>Drenthe</option><option>Flevoland</option><option>Friesland</option>
                        <option>Gelderland</option><option>Groningen</option><option>Limburg</option>
                        <option>Noord-Brabant</option><option>Noord-Holland</option><option>Overijssel</option>
                        <option>Utrecht</option><option>Zeeland</option><option>Zuid-Holland</option>
                    </select>

                    <select id="planbaarFilter" class="filter-select">
                        <option value="">Alle planbaar</option>
                        <option>Drenthe</option><option>Flevoland</option><option>Friesland</option>
                        <option>Gelderland</option><option>Groningen</option><option>Limburg</option>
                        <option>Noord-Brabant</option><option>Noord-Holland</option><option>Overijssel</option>
                        <option>Utrecht</option><option>Zeeland</option><option>Zuid-Holland</option>
                    </select>

                    <button class="btn btn-secondary" id="clearFilters">Filters wissen</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Naam</th>
                            <th>E-mail</th>
                            <th>Tarief</th>
                            <th>Intern tarief</th>
                            <th>Functie</th>
                            <th>Team</th>
                            <th>Planbaar</th>
                            <th>Status</th>
                            <th>Acties</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                        <!-- Rijen worden gerenderd vanuit localStorage via applyFilters() -->
                    </tbody>
                </table>
            </div>

            <!-- No results -->
            <div class="no-results" id="noResults" style="display:none;">
                <div class="no-results-icon">üîç</div>
                <h3>Geen medewerkers gevonden</h3>
                <p>Probeer andere zoektermen of filters.</p>
                <button class="btn btn-primary" id="clearAllFilters">Alle filters wissen</button>
            </div>

            <div class="pagination">
                <button class="btn btn-secondary" id="prevPage" disabled>Vorige</button>
                <span class="page-info" id="pageInfo">Pagina 1 van 1</span>
                <button class="btn btn-secondary" id="nextPage" disabled>Volgende</button>
            </div>
        </div>
    </main>

    <!-- Modal nieuw/bewerken -->
    <div class="modal" id="employeeModal" aria-hidden="true" role="dialog" aria-labelledby="modalTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Nieuwe medewerker</h3>
                <button class="modal-close" id="closeModal" aria-label="Sluiten">&times;</button>
            </div>
            <div class="form-info"><small>* Verplichte velden</small></div>
            <form id="employeeForm" class="modal-body" novalidate>
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">Voornaam *</label>
                        <input type="text" id="firstName" name="firstName" maxlength="50" placeholder="Bijv. Jan" aria-describedby="firstNameError">
                        <div class="error-message" id="firstNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="tussenvoegsel">Tussenvoegsel</label>
                        <input type="text" id="tussenvoegsel" name="tussenvoegsel" maxlength="20" placeholder="Bijv. van, de, van der" aria-describedby="tussenvoegselError">
                        <div class="error-message" id="tussenvoegselError"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="lastName">Achternaam *</label>
                    <input type="text" id="lastName" name="lastName" maxlength="50" placeholder="Bijv. de Vries" aria-describedby="lastNameError">
                    <div class="error-message" id="lastNameError"></div>
                </div>

                <div class="form-group">
                    <label for="email">E-mailadres *</label>
                    <input type="email" id="email" name="email" maxlength="100" placeholder="bijv. jan.devries@qplanning.nl" aria-describedby="emailError">
                    <div class="error-message" id="emailError"></div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="tarief">Tarief (‚Ç¨/uur) *</label>
                        <input type="number" id="tarief" name="tarief" step="0.01" min="0" max="999.99" placeholder="Bijv. 75.00" aria-describedby="tariefError">
                        <div class="help-text">Voer het tarief in euro's per uur in</div>
                        <div class="error-message" id="tariefError"></div>
                    </div>
                    <div class="form-group">
                        <label for="internTarief">Intern tarief (‚Ç¨/uur) *</label>
                        <input type="number" id="internTarief" name="internTarief" step="0.01" min="0" max="999.99" placeholder="Bijv. 50.00" aria-describedby="internTariefError">
                        <div class="help-text">Voer het interne tarief in euro's per uur in</div>
                        <div class="error-message" id="internTariefError"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="functie">Functie *</label>
                    <div class="input-dropdown-container">
                        <input type="text" id="functie" name="functie" maxlength="100" placeholder="Bijv. Senior Consultant" autocomplete="off" aria-describedby="functieError">
                        <div class="dropdown-suggestions" id="functieDropdown">
                            <div class="suggestion-item" data-value="Senior Consultant">Senior Consultant</div>
                            <div class="suggestion-item" data-value="Consultant">Consultant</div>
                            <div class="suggestion-item" data-value="Junior Consultant">Junior Consultant</div>
                            <div class="suggestion-item" data-value="Project Manager">Project Manager</div>
                            <div class="suggestion-item" data-value="Team Lead">Team Lead</div>
                            <div class="suggestion-item" data-value="Specialist">Specialist</div>
                            <div class="suggestion-item" data-value="Analist">Analist</div>
                            <div class="suggestion-item" data-value="Developer">Developer</div>
                        </div>
                    </div>
                    <div class="error-message" id="functieError"></div>
                </div>

                <div class="form-group">
                    <label for="team">Team *</label>
                    <select id="team" name="team" aria-describedby="teamError">
                        <option value="">Selecteer een provincie</option>
                        <option>Drenthe</option><option>Flevoland</option><option>Friesland</option>
                        <option>Gelderland</option><option>Groningen</option><option>Limburg</option>
                        <option>Noord-Brabant</option><option>Noord-Holland</option><option>Overijssel</option>
                        <option>Utrecht</option><option>Zeeland</option><option>Zuid-Holland</option>
                    </select>
                    <div class="error-message" id="teamError"></div>
                </div>

                <div class="form-group">
                    <label for="planbaar">Planbaar door teams *</label>
                    <select id="planbaar" name="planbaar" aria-describedby="planbaarError">
                        <option value="">Selecteer een provincie</option>
                        <option>Drenthe</option><option>Flevoland</option><option>Friesland</option>
                        <option>Gelderland</option><option>Groningen</option><option>Limburg</option>
                        <option>Noord-Brabant</option><option>Noord-Holland</option><option>Overijssel</option>
                        <option>Utrecht</option><option>Zeeland</option><option>Zuid-Holland</option>
                    </select>
                    <div class="error-message" id="planbaarError"></div>
                </div>
            </form>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Annuleren</button>
                <button type="submit" class="btn btn-primary" form="employeeForm">Opslaan</button>
            </div>
        </div>
    </div>

    <!-- Error popup modal -->
    <div class="modal" id="errorModal" aria-hidden="true" role="dialog" aria-labelledby="errorTitle">
        <div class="modal-content error-modal-content">
            <div class="modal-header">
                <h3 id="errorTitle">Er zijn fouten gevonden</h3>
                <button class="modal-close" id="closeErrorModal" aria-label="Sluiten">&times;</button>
            </div>
            <div class="modal-body">
                <div class="error-list" id="errorList"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="closeErrorBtn">OK</button>
            </div>
        </div>
    </div>

    <!-- Confirm -->
    <div class="modal" id="confirmModal" aria-hidden="true" role="dialog" aria-labelledby="confirmTitle">
        <div class="modal-content confirm-modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">Bevestiging vereist</h3>
                <button class="modal-close" id="closeConfirmModal" aria-label="Sluiten">&times;</button>
            </div>
            <div class="modal-body">
                <div class="confirm-icon" id="confirmIcon">‚ö†Ô∏è</div>
                <p id="confirmMessage">Weet je zeker dat je deze actie wilt uitvoeren?</p>
                <div class="confirm-details" id="confirmDetails"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelConfirmBtn">Annuleren</button>
                <button type="button" class="btn btn-danger" id="confirmBtn">Bevestigen</button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div class="success-notification" id="successNotification" style="display:none;">
        <div class="success-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <path d="M9 12l2 2 4-4"></path>
                <circle cx="12" cy="12" r="10"></circle>
            </svg>
        </div>
        <div class="success-message" id="successMessage">Actie succesvol uitgevoerd</div>
        <button class="success-close" id="closeSuccessNotification" aria-label="Sluiten">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
        </button>
    </div>
    <div class="info-notification" id="infoNotification" style="display:none;">
        <div class="info-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 16v-4M12 8h.01"></path>
            </svg>
        </div>
        <div class="info-message" id="infoMessage">Informatie</div>
        <button class="info-close" id="closeInfoNotification" aria-label="Sluiten">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
        </button>
    </div>

    <script>
        // ===== Utils =====
        const debounce = (fn, wait = 300) => { let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), wait); }; };

        function showFieldError(field, message) {
            const err = document.getElementById(field.id + 'Error');
            if (!err) return;
            field.classList.add('error');
            field.setAttribute('aria-invalid', 'true');
            err.textContent = message;
            err.classList.add('show');
        }

        function clearFieldError(field) {
            const err = document.getElementById(field.id + 'Error');
            field.removeAttribute('aria-invalid');
            field.classList.remove('error');
            if (err) { err.textContent = ''; err.classList.remove('show'); }
        }

        function isValidEmail(email) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
        function isValidName(name) { return /^[A-Z][a-zA-Z\s\-]*$/.test(name) && name.length >= 2; }
        function isValidTussenvoegsel(t) { return /^[a-zA-Z\s'\.]*$/.test(t); }

        // ===== LocalStorage helpers =====
        function getEmployees() { const e = localStorage.getItem('employees'); return e ? JSON.parse(e) : []; }
        function saveEmployees(e) { localStorage.setItem('employees', JSON.stringify(e)); }
        function getNextId() { const e = getEmployees(); return e.length ? Math.max(...e.map(x => x.id)) + 1 : 1; }
        function addEmployee(data){ const e = getEmployees(); const n = { id: getNextId(), ...data, status:'actief' }; e.push(n); saveEmployees(e); return n; }
        function updateEmployee(id, data){ const e = getEmployees(); const i = e.findIndex(x=>x.id===id); if(i>-1){ e[i]={...e[i],...data}; saveEmployees(e); return e[i]; } return null; }
        function isDuplicateEmail(email, currentId = null){
            const emails = getEmployees().map(emp => ({id: emp.id, email: emp.email.toLowerCase()}));
            const lower = email.toLowerCase();
            return emails.some(x => x.email === lower && x.id !== currentId);
        }

        // ===== Page ready =====
        document.addEventListener('DOMContentLoaded', () => {
            // Dropdowns in header
            const dropdowns = document.querySelectorAll('.dropdown');
            const accountBtn = document.getElementById('accountBtn');
            const accountDropdown = document.querySelector('.account-dropdown');

            dropdowns.forEach(d => {
                const toggle = d.querySelector('.dropdown-toggle');
                toggle.addEventListener('click', (e) => {
                    e.preventDefault(); e.stopPropagation();
                    dropdowns.forEach(o => { if (o !== d) o.classList.remove('active'); });
                    d.classList.toggle('active');
                });
            });
            accountBtn.addEventListener('click', (e) => {
                e.preventDefault(); e.stopPropagation();
                accountDropdown.classList.toggle('active');
                accountBtn.setAttribute('aria-expanded', accountDropdown.classList.contains('active') ? 'true' : 'false');
            });
            document.addEventListener('click', () => {
                dropdowns.forEach(d => d.classList.remove('active'));
                accountDropdown.classList.remove('active');
                accountBtn.setAttribute('aria-expanded','false');
            });

            // Filters + tabel
            setupSearchAndFilters();
            setupRowActions();

            // Modal open/close
            const addEmployeeBtn = document.getElementById('addEmployeeBtn');
            const modal = document.getElementById('employeeModal');
            const closeModal = document.getElementById('closeModal');
            const cancelBtn = document.getElementById('cancelBtn');
            const employeeForm = document.getElementById('employeeForm');

            addEmployeeBtn.addEventListener('click', ()=>openEmployeeModal('new'));
            function closeEmployeeModal(){
                modal.style.display='none';
                employeeForm.reset();
                employeeForm.removeAttribute('data-employee-id');
                employeeForm.querySelectorAll('.error').forEach(el=>el.classList.remove('error'));
                employeeForm.querySelectorAll('.error-message').forEach(el=>{el.textContent=''; el.classList.remove('show');});
            }
            closeModal.addEventListener('click',closeEmployeeModal);
            cancelBtn.addEventListener('click',closeEmployeeModal);
            modal.addEventListener('click', (e)=>{ if(e.target===modal) closeEmployeeModal(); });

            // Error modal
            const errorModal = document.getElementById('errorModal');
            const closeErrorModal = document.getElementById('closeErrorModal');
            const closeErrorBtn = document.getElementById('closeErrorBtn');
            [closeErrorModal, closeErrorBtn].forEach(btn=>btn.addEventListener('click',()=> errorModal.style.display='none'));
            errorModal.addEventListener('click', (e)=>{ if(e.target===errorModal) errorModal.style.display='none'; });

            // ===== Live validatie =====
            // velden
            const firstName = document.getElementById('firstName');
            const lastName = document.getElementById('lastName');
            const tussenvoegsel = document.getElementById('tussenvoegsel');
            const email = document.getElementById('email');
            const tarief = document.getElementById('tarief');
            const internTarief = document.getElementById('internTarief');
            const functie = document.getElementById('functie');
            const team = document.getElementById('team');
            const planbaar = document.getElementById('planbaar');

            const validateNameLive = (field, label) => {
                const v = field.value.trim();
                if (!v) { showFieldError(field, `${label} is verplicht`); return false; }
                if (v.length < 2) { showFieldError(field, `${label} moet minimaal 2 karakters bevatten`); return false; }
                if (!isValidName(v)) { showFieldError(field, `${label} moet beginnen met een hoofdletter en mag geen cijfers of speciale tekens bevatten`); return false; }
                clearFieldError(field); return true;
            };

            const validateEmailLive = debounce(() => {
                const v = email.value.trim();
                const currentId = employeeForm.getAttribute('data-employee-id') ? parseInt(employeeForm.getAttribute('data-employee-id')) : null;
                if (!v) { showFieldError(email, 'E-mailadres moet een geldig formaat hebben (bijv. naam@domein.com)'); return; }
                if (!isValidEmail(v)) { showFieldError(email, 'E-mailadres moet een geldig formaat hebben (bijv. naam@domein.com)'); return; }
                if (isDuplicateEmail(v, currentId)) { showFieldError(email, 'Dit e-mailadres is al in gebruik'); return; }
                clearFieldError(email);
            }, 250);

            const validateBedragLive = (field, label) => {
                const v = field.value.trim();
                if (!v) { showFieldError(field, `${label} is verplicht`); return false; }
                const num = parseFloat(v);
                if (isNaN(num)) { showFieldError(field, `Voer een geldig bedrag in`); return false; }
                if (num < 0 || num > 999.99) { showFieldError(field, `${label} moet tussen ‚Ç¨0,00 en ‚Ç¨999,99 liggen`); return false; }
                // Tarieven onderlinge check
                const t = parseFloat(tarief.value);
                const it = parseFloat(internTarief.value);
                if (!isNaN(t) && !isNaN(it) && it > t) {
                    showFieldError(internTarief, 'Intern tarief mag niet hoger zijn dan het normale tarief');
                    if (field === tarief) clearFieldError(tarief);
                    return false;
                } else {
                    clearFieldError(internTarief);
                }
                clearFieldError(field); return true;
            };

            const validateSelectLive = (field, label) => {
                const v = field.value.trim();
                if (!v) { showFieldError(field, `Selecteer ${label.toLowerCase()}`); return false; }
                clearFieldError(field); return true;
            };

            // Functie typeahead validatie
            function validateFunctieLive() {
                const v = functie.value.trim().toLowerCase();
                const suggestions = Array.from(document.querySelectorAll('#functieDropdown .suggestion-item'))
                    .map(s => s.getAttribute('data-value').toLowerCase());
                if (!v) { showFieldError(functie, 'Functie is verplicht'); return false; }
                if (!suggestions.includes(v)) { showFieldError(functie, 'Selecteer een geldige functie uit de lijst'); return false; }
                clearFieldError(functie); return true;
            }

            // Event bindings (live)
            firstName.addEventListener('input', ()=>validateNameLive(firstName, 'Voornaam'));
            lastName.addEventListener('input', ()=>validateNameLive(lastName, 'Achternaam'));
            tussenvoegsel.addEventListener('input', ()=>{
                const v = tussenvoegsel.value.trim();
                if (v && !isValidTussenvoegsel(v)) showFieldError(tussenvoegsel, 'Tussenvoegsel mag alleen letters, spaties, apostrofen en punten bevatten');
                else clearFieldError(tussenvoegsel);
            });
            email.addEventListener('input', validateEmailLive);
            tarief.addEventListener('input', ()=>validateBedragLive(tarief, 'Tarief'));
            internTarief.addEventListener('input', ()=>validateBedragLive(internTarief, 'Intern tarief'));
            team.addEventListener('change', ()=>validateSelectLive(team, 'Team'));
            planbaar.addEventListener('change', ()=>validateSelectLive(planbaar, 'Planbaar door teams'));

            // Functie typeahead UI
            setupDropdownInput('functie','functieDropdown');
            functie.addEventListener('input', ()=>{
                const dd = document.getElementById('functieDropdown');
                dd.style.display='block';
                validateFunctieLive();
            });
            functie.addEventListener('blur', ()=>validateFunctieLive());

            function setupDropdownInput(inputId, dropdownId) {
                const input = document.getElementById(inputId);
                const dropdown = document.getElementById(dropdownId);
                if (!input || !dropdown) return;
                const suggestions = dropdown.querySelectorAll('.suggestion-item');

                input.addEventListener('focus', function() {
                    dropdown.style.display = 'block';
                    filterSuggestions(input.value, suggestions);
                });
                document.addEventListener('click', function(e) {
                    if (!input.contains(e.target) && !dropdown.contains(e.target)) dropdown.style.display = 'none';
                });
                input.addEventListener('input', function() {
                    filterSuggestions(input.value, suggestions);
                    dropdown.style.display = 'block';
                });
                suggestions.forEach(suggestion => {
                    suggestion.addEventListener('click', function() {
                        input.value = this.textContent;
                        dropdown.style.display = 'none';
                        validateFunctieLive();
                    });
                });
                input.addEventListener('keydown', function(e) {
                    const highlighted = dropdown.querySelector('.highlighted');
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        if (highlighted) {
                            highlighted.classList.remove('highlighted');
                            const next = highlighted.nextElementSibling;
                            if (next) next.classList.add('highlighted');
                        } else {
                            suggestions[0]?.classList.add('highlighted');
                        }
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        if (highlighted) {
                            highlighted.classList.remove('highlighted');
                            const prev = highlighted.previousElementSibling;
                            if (prev) prev.classList.add('highlighted');
                        }
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        if (highlighted) {
                            input.value = highlighted.textContent;
                            dropdown.style.display = 'none';
                            validateFunctieLive();
                        }
                    } else if (e.key === 'Escape') {
                        dropdown.style.display = 'none';
                    }
                });
            }
            function filterSuggestions(query, suggestions) {
                const q = (query || '').toLowerCase();
                let any = false;
                suggestions.forEach(s => {
                    const txt = s.textContent.toLowerCase();
                    const show = txt.includes(q);
                    s.style.display = show ? 'block' : 'none';
                    if (show) any = true;
                });
                const dropdown = suggestions[0]?.parentElement;
                if (dropdown) dropdown.style.display = any ? 'block' : 'none';
            }

            // ===== Form Submit (opslaan/bijwerken) =====
            employeeForm.addEventListener('submit', (e)=>{
                e.preventDefault();

                // finale validatie
                const ok =
                    validateNameLive(firstName,'Voornaam') &
                    validateNameLive(lastName,'Achternaam') &
                    (()=>{
                        const v = tussenvoegsel.value.trim();
                        if (v && !isValidTussenvoegsel(v)) { showFieldError(tussenvoegsel,'Tussenvoegsel mag alleen letters, spaties, apostrofen en punten bevatten'); return 0; }
                        clearFieldError(tussenvoegsel); return 1;
                    })() &
                    (isValidEmail(email.value.trim()) && !isDuplicateEmail(email.value.trim(), employeeForm.getAttribute('data-employee-id')?parseInt(employeeForm.getAttribute('data-employee-id')):null) ? (clearFieldError(email),1) : (showFieldError(email, isValidEmail(email.value.trim()) ? 'Dit e-mailadres is al in gebruik' : 'E-mailadres moet een geldig formaat hebben (bijv. naam@domein.com)'),0)) &
                    validateBedragLive(tarief,'Tarief') &
                    validateBedragLive(internTarief,'Intern tarief') &
                    validateFunctieLive() &
                    validateSelectLive(team, 'Team') &
                    validateSelectLive(planbaar, 'Planbaar door teams');

                // indien fouten -> samenvatting tonen
                const errors = Array.from(employeeForm.querySelectorAll('.error-message.show')).map(e=>e.textContent).filter(Boolean);
                if (!ok || errors.length) {
                    const errorList = document.getElementById('errorList');
                    errorList.innerHTML = '';
                    errors.forEach(err => {
                        const div = document.createElement('div');
                        div.className = 'error-item';
                        div.textContent = '‚Ä¢ ' + err;
                        errorList.appendChild(div);
                    });
                    document.getElementById('').style.display='flex';
                    return;
                }

                // data verzamelen
                const formData = new FormData(employeeForm);
                const payload = {
                    firstName: formData.get('firstName'),
                    tussenvoegsel: formData.get('tussenvoegsel') || '',
                    lastName: formData.get('lastName'),
                    email: formData.get('email'),
                    tarief: parseFloat(formData.get('tarief')),
                    internTarief: parseFloat(formData.get('internTarief')),
                    functie: formData.get('functie'),
                    team: formData.get('team'),
                    planbaar: formData.get('planbaar')
                };

                const idAttr = employeeForm.getAttribute('data-employee-id');
                const isEdit = idAttr !== null;

                // opslaan
                if (isEdit) {
                    updateEmployee(parseInt(idAttr), payload);
                    showSuccess('Medewerker succesvol bijgewerkt!');
                } else {
                    addEmployee(payload);
                    showSuccess('Medewerker succesvol toegevoegd!');
                }

                // UI reset
                closeEmployeeModal();
                refreshTableData();
            });

            function showSuccess(msg){
                const box = document.getElementById('successNotification');
                document.getElementById('successMessage').textContent = msg;
                box.style.display='flex';
                setTimeout(()=> box.style.display='none', 2500);
            }
            document.getElementById('closeSuccessNotification').addEventListener('click', ()=> {
                document.getElementById('successNotification').style.display='none';
            });

            // ===== Tabel/filter-logica =====
            function setupSearchAndFilters(){
                const searchInput = document.getElementById('searchInput');
                const clearSearchBtn = document.getElementById('clearSearch');
                const statusFilter = document.getElementById('statusFilter');
                const teamFilter = document.getElementById('teamFilter');
                const planbaarFilter = document.getElementById('planbaarFilter');
                const clearFiltersBtn = document.getElementById('clearFilters');
                const clearAllFiltersBtn = document.getElementById('clearAllFilters');
                const tableBody = document.getElementById('employeeTableBody');
                const noResults = document.getElementById('noResults');
                const tableContainer = document.querySelector('.table-container');

                function applyFilters(){
                    const employees = getEmployees();
                    const q = searchInput.value.toLowerCase().trim();
                    const s = statusFilter.value;
                    const t = teamFilter.value;
                    const p = planbaarFilter.value;

                    const filtered = employees.filter(emp=>{
                        const full = `${emp.firstName} ${emp.tussenvoegsel ? emp.tussenvoegsel + ' : ' : ''}${emp.lastName}`.toLowerCase().replace(' : ',' ');
                        const matchQ = !q || full.includes(q) || emp.email.toLowerCase().includes(q) || (emp.functie||'').toLowerCase().includes(q) || (emp.team||'').toLowerCase().includes(q) || (emp.planbaar||'').toLowerCase().includes(q);
                        const matchS = !s || emp.status === s;
                        const matchT = !t || emp.team === t;
                        const matchP = !p || emp.planbaar === p;
                        return matchQ && matchS && matchT && matchP;
                    });

                    if (!filtered.length){
                        tableContainer.style.display='none';
                        noResults.style.display='block';
                        return;
                    }
                    tableContainer.style.display='block';
                    noResults.style.display='none';
                    tableBody.innerHTML='';
                    filtered.forEach(emp=>{
                        const tr = document.createElement('tr');
                        tr.setAttribute('data-employee-id', emp.id);
                        tr.innerHTML = `
                            <td>${emp.firstName} ${emp.tussenvoegsel ? emp.tussenvoegsel + ' ' : ''}${emp.lastName}</td>
                            <td>${emp.email}</td>
                            <td>‚Ç¨${emp.tarief}/uur</td>
                            <td>‚Ç¨${emp.internTarief}/uur</td>
                            <td>${emp.functie}</td>
                            <td>${emp.team}</td>
                            <td><span class="status-badge status-text">${emp.planbaar}</span></td>
                            <td><span class="status-badge ${emp.status === 'actief' ? 'status-active' : 'status-inactive'}">${emp.status === 'actief' ? 'Actief' : 'Inactief'}</span></td>
                            <td class="actions">
                                <div class="action-buttons">
                                    <button class="btn-action" title="Bewerken">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                        </svg>
                                        <span>Bewerken</span>
                                    </button>
                                    <button class="btn-action ${emp.status==='actief'?'btn-warning':'btn-success'}" title="${emp.status==='actief'?'Deactiveren':'Activeren'}">
                                        ${
                                            emp.status==='actief'
                                            ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                   <path d="M18 6L6 18"></path>
                                                   <path d="M6 6l12 12"></path>
                                               </svg>
                                               <span>Deactiveren</span>`
                                            : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                   <path d="M9 12l2 2 4-4"></path>
                                                   <circle cx="12" cy="12" r="10"></circle>
                                               </svg>
                                               <span>Activeren</span>`
                                        }
                                    </button>
                                </div>
                            </td>`;
                        tableBody.appendChild(tr);
                    });
                    setupRowActions();
                }

                searchInput.addEventListener('input', debounce(applyFilters, 150));
                clearSearchBtn.addEventListener('click', ()=>{ searchInput.value=''; applyFilters(); });
                [statusFilter, teamFilter, planbaarFilter].forEach(f=> f.addEventListener('change', applyFilters));
                clearFiltersBtn.addEventListener('click', ()=>{ statusFilter.value=''; teamFilter.value=''; planbaarFilter.value=''; searchInput.value=''; applyFilters(); });
                if (clearAllFiltersBtn) clearAllFiltersBtn.addEventListener('click', ()=>{ statusFilter.value=''; teamFilter.value=''; planbaarFilter.value=''; searchInput.value=''; applyFilters(); });

                // eerste render
                applyFilters();
            }

            function setupRowActions(){
                document.querySelectorAll('.btn-action[title="Bewerken"]').forEach(btn=>{
                    btn.onclick = function(){
                        const id = parseInt(this.closest('tr').getAttribute('data-employee-id'));
                        openEmployeeModal('edit', id);
                    };
                });
                document.querySelectorAll('.btn-action[title="Deactiveren"], .btn-action[title="Activeren"]').forEach(btn=>{
                    btn.onclick = function(){
                        const id = parseInt(this.closest('tr').getAttribute('data-employee-id'));
                        toggleEmployeeStatus(id);
                    };
                });
            }

            function toggleEmployeeStatus(id){
                const employees = getEmployees();
                const i = employees.findIndex(e=>e.id===id);
                if (i>-1){
                    employees[i].status = employees[i].status==='actief' ? 'inactief' : 'actief';
                    saveEmployees(employees);
                    refreshTableData();
                }
            }

            function openEmployeeModal(mode, employeeId=null){
                const modal = document.getElementById('employeeModal');
                const modalTitle = document.getElementById('modalTitle');
                const employeeForm = document.getElementById('employeeForm');
                employeeForm.reset();
                employeeForm.querySelectorAll('.error').forEach(el=>el.classList.remove('error'));
                employeeForm.querySelectorAll('.error-message').forEach(el=>{el.textContent=''; el.classList.remove('show');});

                if (mode === 'new'){
                    modalTitle.textContent='Nieuwe medewerker';
                    employeeForm.removeAttribute('data-employee-id');
                } else {
                    modalTitle.textContent='Medewerker bewerken';
                    employeeForm.setAttribute('data-employee-id', String(employeeId));
                    const emp = getEmployees().find(e=>e.id===employeeId);
                    if (emp){
                        firstName.value = emp.firstName;
                        tussenvoegsel.value = emp.tussenvoegsel || '';
                        lastName.value = emp.lastName;
                        email.value = emp.email;
                        tarief.value = emp.tarief;
                        internTarief.value = emp.internTarief;
                        functie.value = emp.functie;
                        team.value = emp.team || '';
                        planbaar.value = emp.planbaar || '';
                    }
                }
                modal.style.display='flex';
            }

            function refreshTableData(){
                const statusFilter = document.getElementById('statusFilter');
                statusFilter.dispatchEvent(new Event('change'));
            }
        });
    </script>
</body>
</html>
