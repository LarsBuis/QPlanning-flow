<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overzicht - QPlanning</title>
    <link rel="stylesheet" href="../styles.css">

    <style>
        .week-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .week-navigation span {
            font-weight: 500;
            color: #2c3e50;
        }

        /* speciale rijen in de tabel */
        .medewerker-row td {
            font-weight: 600;
            background: #f9fafb;
        }

        .klant-row td:first-child {
            padding-left: 2rem;
            font-weight: 500;
            color: #374151;
        }

        .klant-row td {
            background: #fff;
        }

        /* optische scheiding tussen medewerkers */
        .medewerker-row td {
            border-top: 2px solid #e5e7eb;
        }
    </style>
</head>

<body>
<header class="header">
    <div class="header-container">
        <div class="header-left">
            <div class="logo">
                <h1>QPlanning</h1>
            </div>
            <nav class="main-nav">
                <ul class="nav-list">
                    <li><a href="/index.html" class="nav-link active">Overzicht</a></li>

                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle">Plannen</a>
                        <ul class="dropdown-menu">
                            <li><a href="/Boekingen/BoekingOverzicht.html" class="dropdown-link">Boekingen</a></li>
                            <li><a href="#" class="dropdown-link">Klantenplanning</a></li>
                            <li><a href="/Medewerkerplanning/medewerkerplanning.html" class="dropdown-link">Medewerkerplanning</a></li>
                        </ul>
                    </li>

                    <li class="dropdown">
                        <a href="#" class="nav-link dropdown-toggle">Beheer</a>
                        <ul class="dropdown-menu">
                            <li><a href="/klanten/klant.html" class="dropdown-link">Klanten beheren</a></li>
                            <li><a href="/Medewerker/medewerkerbeheer.html" class="dropdown-link">Medewerkers beheren</a></li>
                            <li><a href="/Gebruikers/Gebruikers.html" class="dropdown-link">Gebruikers beheren</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
        
        <div class="header-right">
            <div class="account-dropdown">
                <button class="account-btn" id="accountBtn">
                    <svg class="account-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </button>
                <ul class="account-menu" id="accountMenu">
                    <li><a href="#" class="account-link">Wijzig wachtwoord</a></li>
                    <li><a href="#" class="account-link">Log uit</a></li>
                </ul>
            </div>
        </div>
    </div>
</header>

<main class="main-content">
    <div class="content-container">
        <div class="page-header">
            <h2>Overzicht geplande uren</h2>
        </div>

        <div class="week-navigation">
            <button class="btn btn-secondary" id="prevPage">Vorige pagina</button>
            <span id="weekRangeLabel">Week 1–5</span>
            <button class="btn btn-secondary" id="nextPage">Volgende pagina</button>
        </div>

        <div class="table-container">
            <table class="data-table" id="planningTable">
                <thead>
                    <tr id="tableHeadRow">
                        <th>Naam medewerker / Klant</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
</main>

<script>
    // ---- NAVBAR LOGICA ----
    document.addEventListener('DOMContentLoaded', function () {
        // Dropdowns in hoofdmenu (Plannen / Beheer)
        const dropdowns = document.querySelectorAll('.dropdown');
        dropdowns.forEach(dropdown => {
            const toggle = dropdown.querySelector('.dropdown-toggle');
            toggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                // eerst andere dropdowns dicht
                dropdowns.forEach(d => { if (d !== dropdown) d.classList.remove('active'); });

                // deze togglen
                dropdown.classList.toggle('active');
            });
        });

        // Account dropdown rechtsboven
        const accountDropdown = document.querySelector('.account-dropdown');
        const accountBtn = document.getElementById('accountBtn');

        accountBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            accountDropdown.classList.toggle('active');
        });

        // Klik buiten -> alles sluiten
        document.addEventListener('click', function() {
            dropdowns.forEach(d => d.classList.remove('active'));
            accountDropdown.classList.remove('active');
        });

        // Klik binnen menu -> niet bubbelen
        document.querySelectorAll('.dropdown-menu, .account-menu').forEach(menu => {
            menu.addEventListener('click', e => e.stopPropagation());
        });
    });

    // ---- PLANNING DATA ----
    // Datastructuur:
    // [
    //   {
    //     medewerker: "Jan Jansen",
    //     klanten: [
    //       { klant: "Groot Bedrijf BV", urenPerWeek: { 1: 6, 2: 4, ... } },
    //       { klant: "Tech Solutions NL", urenPerWeek: { ... } }
    //     ]
    //   },
    //   ...
    // ]
    //
    // Hier staan demo-data. Je kunt dit straks vervangen door echte planning uit je backend.
    const planningData = [
        {
            medewerker: "Jan Jansen",
            klanten: [
                { klant: "Groot Bedrijf BV", urenPerWeek: {} },
                { klant: "Tech Solutions NL", urenPerWeek: {} }
            ]
        }
    ];

    // Helper: random uren voor demo
    function generateRandomHours() {
        // aantal uur in een week op een specifieke klant voor een medewerker
        // random 0 t/m 8 uur
        return Math.floor(Math.random() * 9);
    }

    // Voor elk zichtbaar weeknummer uren invullen als ze er nog niet zijn
    function fillWeekHoursForRange(startWeek, endWeek) {
        planningData.forEach(medewerker => {
            medewerker.klanten.forEach(entry => {
                for (let w = startWeek; w <= endWeek; w++) {
                    if (entry.urenPerWeek[w] === undefined) {
                        entry.urenPerWeek[w] = generateRandomHours();
                    }
                }
            });
        });
    }

    // ---- PAGINERING INSTELLINGEN ----
    const totalWeeks = 52;
    const weeksPerPage = 5;
    let currentPage = 0;

    // ---- TABEL RENDER ----
    function renderTable() {
        const startWeek = currentPage * weeksPerPage + 1;
        const endWeek = Math.min(startWeek + weeksPerPage - 1, totalWeeks);

        // Label bovenin
        const weekRangeLabel = document.getElementById("weekRangeLabel");
        weekRangeLabel.textContent = `Week ${startWeek}–${endWeek}`;

        // Zorg dat de data voor deze weken gevuld is
        fillWeekHoursForRange(startWeek, endWeek);

        // TABLE HEAD
        const headRow = document.getElementById("tableHeadRow");
        headRow.innerHTML = `<th>Overzicht</th>`;
        for (let i = startWeek; i <= endWeek; i++) {
            headRow.innerHTML += `<th>Week ${i}</th>`;
        }

        // TABLE BODY
        const body = document.getElementById("tableBody");
        body.innerHTML = "";

        planningData.forEach(medewerker => {
            // 1. Rij voor medewerker zelf (som van alle klanturen)
            const medewerkerRow = document.createElement("tr");
            medewerkerRow.classList.add("medewerker-row");

            let medewerkerHTML = `<td>${medewerker.medewerker}</td>`;

            for (let w = startWeek; w <= endWeek; w++) {
                // sommeer uren over alle klanten voor deze medewerker in deze week
                let som = 0;
                medewerker.klanten.forEach(entry => {
                    const uren = entry.urenPerWeek[w] || 0;
                    som += uren;
                });

                medewerkerHTML += `<td>${som} u</td>`;
            }

            medewerkerRow.innerHTML = medewerkerHTML;
            body.appendChild(medewerkerRow);

            // 2. Rij per klant onder die medewerker
            medewerker.klanten.forEach(entry => {
                const klantRow = document.createElement("tr");
                klantRow.classList.add("klant-row");

                let klantHTML = `<td>${entry.klant}</td>`;
                for (let w = startWeek; w <= endWeek; w++) {
                    const uren = entry.urenPerWeek[w] ?? 0;
                    klantHTML += `<td>${uren} u</td>`;
                }

                klantRow.innerHTML = klantHTML;
                body.appendChild(klantRow);
            });
        });

        // Navigatieknoppen updaten
        document.getElementById("prevPage").disabled = currentPage === 0;
        document.getElementById("nextPage").disabled = endWeek >= totalWeeks;
    }

    // ---- PAGINERING BUTTON EVENTS ----
    document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 0) {
            currentPage--;
            renderTable();
        }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
        if ((currentPage + 1) * weeksPerPage < totalWeeks) {
            currentPage++;
            renderTable();
        }
    });

    // Init tabel zodra DOM klaar is
    document.addEventListener("DOMContentLoaded", renderTable);
</script>

</body>
</html>
